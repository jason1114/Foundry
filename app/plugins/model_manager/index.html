<div ng-controller="ModelController">
	<div class="breadcrumb">
	    <h1>Model Management</h1>
	</div>
	<div class="model-editor" ng-if="selected_model">
		<ul class="nav nav-tabs">
		  <li class="{{selected_model==name?'active':''}}" ng-repeat="(name, fields) in generated_models" ng-click="change_selected(name)"><a href="#model_{{encodeURI(name)}}" data-toggle="tab">{{name}}</a></li>
		</ul>
		<div class="tab-content">
			<div class="tab-pane {{selected_model==name?'active':''}}" ng-repeat="(name, fields) in generated_models" id="model_{{encodeURI(name)}}">
				<table class="bordered">
				    <thead>
					    <tr>
					    	<th>*</th>
					        <th ng-repeat="field_info in fields" >{{field_info.name}}</th>
					        <th>Actions</th>
					    </tr>
				    </thead>
				    <tbody>
				    	<tr ng-repeat-start="record in user_records[name]">
				    		<td><label for="{{name}}-{{$index}}" class="show-row-detail btn btn-mini btn-success"><i class="icon-plus"></i></label></td>
				    		<td ng-repeat="field_info in fields">
				    			<div ng-if="!is_field_hidden(field_info.type)">
				    				<div ng-if="field_info.type=='_field_text_input'">
					    				{{record[field_info.name]}}
					    			</div>
					    			<div ng-if="field_info.type=='_field_number_input'">
					    				{{record[field_info.name]}}
					    			</div>
					    			<div ng-if="field_info.type=='_field_rate'">
					    				<form>
						    				<fieldset class="rating" ng-init="current[selected_model][field_info.name]=field_info.setting.default_value">
									      		<input ng-repeat-start="i in make_range(field_info.setting.max_rate, 1, -1)" type="radio" id="{{field_info.name}}-{{record.id}}-{{i}}" name="rating" value="{{i}}" ng-model="record[field_info.name]" disabled/><label ng-repeat-end for="{{field_info.name}}-{{record.id}}-{{i}}" title="Rocks!">{{i}} stars</label>
											</fieldset>
										</form>
					    			</div>
					    			<div ng-if="field_info.type=='_field_switch'">
					    				<label class="switch_wrap" for="{{field_info.name}}-{{record.id}}">
									  		<input id="{{field_info.name}}-{{record.id}}" type="checkbox" ng-model="record[field_info.name]"/ ng-true-value="{{field_info.setting.on_value}}" ng-false-value="{{field_info.setting.off_value}}" disabled>
									  		<div class="switch"><span class="bullet"></span></div>
								  		</label>
					    			</div>
				    			</div>
				    			<em ng-if="is_field_hidden(field_info.type)">See details</em>
				    		</td>
				    		<td class="record-edit">
				    			<a class="btn btn-small btn-info"><i class="icon-pencil"></i></a>
				    			<a class="btn btn-small btn-danger" ng-click="del(record,$index)"><i class="icon-remove"></i></a>
				    		</td>
				    	</tr>
				    	<tr ng-repeat-end class="row-detail">
				    		
				    		<td colspan="{{fields.length+2}}">
				    			<div class="row">
				    				<input class="show-detail-input" type="checkbox" id="{{name}}-{{$index}}">
				    				<form>
					    				<div class="span6">
					    					<div class="row" ng-repeat="field_info in fields" ng-if="hide_in_left.indexOf(field_info.type)!=-1">
					    						<div ng-if="field_info.type=='_field_image'">
					    							<label>{{field_info.name}}</label>
								    				<img ng-src="{{record[field_info.name]}}" />
									    			
								    			</div>
							    			</div>
					    				</div>
					    				<div class="span6">
					    					<div class="row" ng-repeat="field_info in fields" ng-if="hide_in_right.indexOf(field_info.type)!=-1">
							    				<div ng-if="field_info.type=='_field_text_area'">
							    					<label>{{field_info.name}}</label>
							    					<textarea style="width:97%;" disabled>{{record[field_info.name]}}</textarea>
								    			</div>
							    			</div>
					    				</div>
					    			</form>
				    			</div>
				    		</td>
				    	</tr>
					</tbody>
				</table>
			</div>
		</div>
		
		<form class="form-horizontal model-edit" ng-submit="add()">
			<div class="row" ng-if="selected_model">
				<div class="span6">
					<div ng-repeat="field_info in generated_models[selected_model]">
					  	<!-- for switch -->
					  	<div class="control-group" ng-if="field_info.type=='_field_switch'">
					    	<label class="control-label" for="mode">{{field_info.name}}</label>
					    	<div class="controls">
						        <label class="switch_wrap" for="switch-{{field_info.name}}">
								  <input id="switch-{{field_info.name}}" type="checkbox" ng-model="current[selected_model][field_info.name]" 
								 ng-init="current[selected_model][field_info.name]=(field_info.setting.default_value?field_info.setting.on_value:field_info.setting.off_value)" ng-true-value="{{field_info.setting.on_value}}" ng-false-value="{{field_info.setting.off_value}}"/>
								  <div class="switch"><span class="bullet"></span></div>
								</label>
					    	</div>
					    </div>
					    <!-- for text input -->
					    <div class="control-group" ng-if="field_info.type=='_field_text_input'">
						    <label class="control-label">{{field_info.name}}</label>
						    <div class="controls">
						      <input type="text" ng-model="current[selected_model][field_info.name]" ng-init="current[selected_model][field_info.name]=field_info.setting.default_value" placeholder="" value="{{field_info.setting.default_value}}" ng-required="field_info.setting.required">
						    </div>
					    </div>
					    <!-- for number input -->
					    <div class="control-group" ng-if="field_info.type=='_field_number_input'">
						    <label class="control-label">{{field_info.name}}</label>
						    <div class="controls">
						      <input type="number" ng-model="current[selected_model][field_info.name]" ng-init="current[selected_model][field_info.name]=field_info.setting.default_value" placeholder="" value="{{field_info.setting.default_value}}" ng-required="field_info.setting.required">
						    </div>
					    </div>
					  	
					  	<div class="control-group" ng-if="field_info.type=='_field_rate'">
						    <label class="control-label">{{field_info.name}}</label>
						    <div class="controls">
						      	<fieldset class="rating" ng-init="current[selected_model][field_info.name]=field_info.setting.default_value">
						      		<input ng-repeat-start="i in make_range(field_info.setting.max_rate, 1, -1)" type="radio" id="{{field_info.name}}-star-{{field_info.setting.max_rate+'-'+i}}" name="rating" value="{{i}}" ng-model="current[selected_model][field_info.name]"/><label ng-repeat-end for="{{field_info.name}}-star-{{field_info.setting.max_rate+'-'+i}}" title="Rocks!">{{i}} stars</label>
								</fieldset>
						    </div>
					  	</div>
					</div>
				</div>
				<div class="span5">
					<div ng-repeat="field_info in generated_models[selected_model]">
						<div ng-if="field_info.type=='_field_image'">
							<div class="control-group">
							    <label class="control-label" for="image" style="text-align:left;">{{field_info.name}}</label>
							    <div class="controls">
							    	<span class="btn btn-file pull-right"> <span class="fileupload-new">Select</span> <input type="file" data-field="{{field_info.name}}" onchange="angular.element(this).scope().fileNameChanged()" id=""> </span>
							    	<a class="btn btn-success" ng-show="current[selected_model][field_info.name+'_choosed_file_']" ng-click="upload(field_info.name)">Upload</a>
							    	<input type="hidden" id="image" ng-model="current[selected_model][field_info.name]" ng-required="field_info.setting.required">
							    </div>
							</div>
							<div class="user_listing" ng-if="current[selected_model][field_info.name+'_uploaded_']"> 
								<i class="file_thumb" style="background-image:url({{current[selected_model][field_info.name+'_uploaded_'].thumb}});"></i> 
								<a href="{{current[selected_model][field_info.name+'_uploaded_'].link}}">
									<span class="name">{{current[selected_model][field_info.name+'_uploaded_'].name}}</span>
								</a> 
							</div>
						</div>
						<div class="control-group" ng-if="field_info.type=='_field_text_area'">
						    <textarea placeholder="" style="width:100%;height:100px;padding: 2px 0 2px 0;" ng-model="current[selected_model][field_info.name]" ng-init="current[selected_model][field_info.name]=field_info.setting.default_value" ng-required="field_info.setting.required">{{field_info.setting.default_value}}</textarea>
						</div>
					</div>
					<div class="control-group" >
					    <div class="controls">
					    	<input type="reset" class="btn btn-inverse pull-right" value="Reset" style="margin-left: 1em;">
					      	<input type="submit" class="btn btn-success pull-right" value="Add Instance">
					    </div>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div ng-if="!selected_model">
		Sorry, there have not been any models arleady.
	</div>
</div>